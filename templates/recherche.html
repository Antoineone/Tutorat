<!DOCTYPE html>

<head>
    <meta charset="utf-8"/>
    <title>Liste des offres</title>
    <link rel=stylesheet type=text/css href="/static/style.css">
    <link rel="icon" type="image/png" href="/static/favicon.png"/>
</head>
<body>

{% include 'HEADER.html' %}

<!-- Critères de recherche -->
<form class="search" method="post" action="search">
    <fieldset>
        <!-- Rechargement de la page lors du changement de la méthode de tri -->
        <select class="tri" name="option" required onchange="this.form.submit()">
            <option value="" disabled {% if not option %}selected{% endif %}>- Tri -</option>
            <option value="date_time" {% if option == "date_time" %}selected{% endif %}>Date croissante</option>
            <option value="niveau" {% if option == "niveau" %}selected{% endif %}>Niveau</option>
            <option value="filiere" {% if option == "filiere" %}selected{% endif %}>Filière</option>
            <option value="matiere" {% if option == "matiere" %}selected{% endif %}>Matière</option>
        </select>

        {% if not option2 and (option == "niveau" or option == "matiere" or option == "filiere") %}
            <!-- Paramètre de tri 2 pas encore défini-->
            <select class="tri" name="option2" onchange="this.form.submit()">

                <option value="" disabled selected>- Tri -</option>
                {% if option == "niveau" %}
                    {% for niveau in niveaux %}
                        <option>{{ niveau }}</option>
                    {% endfor %}
                {% elif option == "matiere" %}
                    {% for matiere in matieres %}
                        <option>{{ matiere }}</option>
                    {% endfor %}
                {% elif option == "filiere" %}
                    {% for filiere in filieres %}
                        <option>{{ filiere }}</option>
                    {% endfor %}
                {% endif %}
            </select>
        {% elif option2 and option=="niveau" %}
            <!-- Paramètre de tri 2 défini-->
            <select class="tri" name="option2" onchange="this.form.submit()">
                <option value="" disabled selected>- Tri -</option>
                {% for niveau in niveaux %}
                    <option {% if option2 == niveau %}selected{% endif %}>{{ niveau }}</option>
                {% endfor %}
            </select>

        {% elif option2 and option=="matiere" %}
            <!-- Paramètre de tri 2 défini-->
            <select class="tri" name="option2" onchange="this.form.submit()">
                <option value="" disabled selected>- Tri -</option>
                {% for matiere in matieres %}
                    <option {% if option2 == matiere %}selected{% endif %}>{{ matiere }}</option>
                {% endfor %}
            </select>

        {% elif option2 and option=="filiere" %}
            <!-- Paramètre de tri 2 défini-->
            <select class="tri" name="option2" onchange="this.form.submit()">
                <option value="" disabled selected>- Tri -</option>
                {% for filiere in filieres %}
                    <option {% if option2 == filiere %}selected{% endif %}>{{ filiere }}</option>
                {% endfor %}
            </select>

        {% endif %}
    </fieldset>
</form>

{% if info_msg %}
    <!-- Message d'information -->
    <a href="search">
        <button class="created">{{ info_msg }}</button>
    </a>
{% endif %}

<!-- Liste des offres -->
<div class="offres">
    {% if offres|length>0 %}
        {% for offre in offres %}
            <br/>
            <div class="bloc">
                <div class="not">
                    <p class="element"><strong class="G">Auteur:</strong> {{ offre[1] }}</p>
                    <p class="element"><strong class="G">Niveau:</strong> {{ offre[2] }}</p>
                    <p class="element"><strong class="G">Filière:</strong> {{ offre[3] }}</p>
                    <p class="element"><strong class="G">Matière:</strong> {{ offre[4] }}</p>
                    <form class="bouton" method="post" action="apply">
                        <input type="hidden" name="id" value="{{ offre[0] }}"/>
                        <input type="submit" value="Accepter l'offre"/>
                    </form>
                </div>
                <div class="horaire">
                    <div class="table">
                        {% for i in range(0,12,2) %}{% if offre[9+i] is not none and offre[10+i] is not none %}
                            <p>{{ days[i//2] }}:</p>
                        {% endif %}{% endfor %}
                    </div>
                    <div class="table">
                        {% for i in range(0,12,2) %}{% if offre[9+i] is not none and offre[10+i] is not none %}
                            <p>{{ 'h'.join((offre[9+i]|string).split(':')[:2]) }} - {{ 'h'.join((offre[10+i]|string).split(':')[:2]) }}</p>
                        {% endif %}{% endfor %}
                    </div>
                </div>
                <div>
                    <p class="time"><strong class="G">Publié le:</strong> {{ offre[5].strftime('%d-%m-%Y') }}</p>
                </div>
            </div>
            <br/>
        {% endfor %}
    {% else %}
        <p>Aucune offre n'a été trouvée</p>
    {% endif %}
</div>

<div>
    <p>{% if page>0 %}<a href="search?page={{ page-1 }}">Page précédente</a>{% endif %} {{ page }} <a
            href="search?page={{ 1+page }}">Page suivante</a></p>
</div>

{% include 'FOOTER.html' %}

</body>
