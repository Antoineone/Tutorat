<!DOCTYPE html>
<html>

{% with name="Liste des offres" %}{% include "mise_en_page/HEAD.html" %}{% endwith %}

<body>

{% include 'mise_en_page/HEADER.html' %}

<!-- Critères de recherche -->
<form class="search" method="post" action="/search">
    <div class="critere">

        <a class="button" id="reset_filter" onclick="window.location.href=window.location.pathname">Réinitialiser les
            filtres</a>

        <!-- Rechargement de la page lors du changement de catégorie -->
        <select class="tri" name="categorie" onchange="this.form.submit()">
            <option value="offre" selected>Offre</option>
            <option value="demande">Demande</option>
        </select>

        <!-- Rechargement de la page lors du changement de la méthode de tri -->
        <select class="tri" name="option"
                onchange="if(document.getElementById('option2')!=null){document.getElementById('option2').selectedIndex = -1}this.form.submit()">
            <option value="" disabled {% if not option %}selected{% endif %}>- Trier par -</option>
            <option value="date_time" {% if option == "date_time" %}selected{% endif %}>Date croissante</option>
            <option value="filiere" {% if option == "filiere" %}selected{% endif %}>Filière</option>
            <option value="matiere" {% if option == "matiere" %}selected{% endif %}>Matière</option>
        </select>

        {% if option == "matiere" or option == "filiere" %}
            <!-- Paramètre de tri 2 -->
            <select id="option2" class="tri" name="option2" onchange="this.form.submit()">
                <option value="" disabled selected>- Trier par -</option>
                {% if option == "filiere" %}
                    {% for filiere in filieres %}
                        <option {% if option2 == filiere %}selected{% endif %}>{{ filiere }}</option>
                    {% endfor %}
                {% elif option == "matiere" %}
                    {% for matiere in matieres %}
                        <option {% if option2 == matiere %}selected{% endif %}>{{ matiere }}</option>
                    {% endfor %}
                {% endif %}
            </select>
        {% endif %}
    </div>

    <!-- Gestion des pages-->
    <div class="pages">
        <p>
            <input type="hidden" name="page" value="{{ page }}">
            {% if page>0 %}<input type="submit" name="precedent" value="Page précédente">
            {% else %}<input type="submit" name="suivant" value="Page suivante">{% endif %}
            <strong class="G">{{ page + 1 }}</strong>
            <input type="submit" name="suivant" value="Page suivante">
        </p>
    </div>
</form>

{% if select_H %}
    <form method="post" action="/edit_o" class="form_crea">
        <div class="creation">
            <div class="bloc">
                <div class="info_crea">
                    <h2>Selection des horaires</h2>
                    <p title="Décochez les horaires qui ne vous correspondent pas. Atention, vous devez au minimum avoir 30min de tutorat et au maximum 1h.">Besoin d'aide ?</p>
                </div>
                <!-- Horaires -->
                <div id="horaires_crea">
                    <input type="hidden" id="horaires_data" name="horaires_data" value="{{ O[8] }}"/>
                    <div class="horaire">
                        <div class="table" id="jour-offre">
                            {% for i in range(0,6) %}
                                <p>{{ days[i] }}:</p>
                            {% endfor %}
                        </div>
                        <div class="table" id="table_horaires-2">
                            <table class="heure-table">
                                <tr>
                                    <th>08h</th>
                                    <th></th>
                                    <th>09h</th>
                                    <th></th>
                                    <th>10h</th>
                                    <th></th>
                                    <th>11h</th>
                                    <th></th>
                                    <th>12h</th>
                                    <th></th>
                                    <th>13h</th>
                                    <th></th>
                                    <th>14h</th>
                                    <th></th>
                                    <th>15h</th>
                                    <th></th>
                                    <th>16h</th>
                                    <th></th>
                                    <th>17h</th>
                                    <th></th>
                                    <th>18h</th>
                                    <th></th>
                                </tr>
                            </table>
                            {% for i in range(0,6) %}
                                <table>
                                    <tr>
                                        {% for j in range(0,22) %}
                                            <td id="{{ i }} {{ j }}"
                                                class="{% if O[8][(i*22)+j] == "0" %}white{% else %}red{% endif %}"
                                                onclick="horaire_click(event, this.id, this.className)"></td>
                                        {% endfor %}
                                    </tr>
                                </table>
                            {% endfor %}
                        </div>
                    </div>
                    <input type="submit" class="crea_offre" value="Terminer"/>
                </div>
            </div>
        </div>
    </form>
{% endif %}







<!-- Liste des offres -->
<div class="offres">
    {% if offres|length>0 %}
        {% for offre in offres %}
            <br/>
            <div class="bloc">
                <div class="info">
                    <p class="element"><strong class="G">Auteur:</strong>
                        <a onclick="open_profile_page('{{ offre[1] }}')" title="Voir le profil">{{ sql_obj.get_user_pseudo(offre[1]) }}</a>
                    </p>
                    <p class="element"><strong class="G">Pour des:</strong> {{ offre[2] }}</p>
                    <p class="element"><strong class="G">Matière:</strong> {{ offre[3] }}</p>
                    <p class="element"><strong class="G">Participant(s) :</strong>
                        {% if offre[5] is none %}
                            Aucun
                        {% else %}
                            <a onclick="open_profile_page('{{ offre[5] }}')"
                               title="Voir le profil">{{ sql_obj.get_user_pseudo(offre[5]) }}</a>
                            <br/>
                            (1 place restante)
                        {% endif %}
                    </p>
                </div>
                <div id="horaires">
                    <p class="date_creation">Créée le {{ offre[4].strftime('%d/%m/%Y') }}</p>
                    <div class="horaire">
                        <div class="table" id="jour-offre">
                            {% for i in range(0,6) %}
                                <p>{{ days[i] }}:</p>
                            {% endfor %}
                        </div>
                        <div class="table" id="table_horaires">
                            <table class="heure-table">
                                <tr>
                                    <th>08h</th> <th></th> <th>09h</th> <th></th> <th>10h</th> <th></th>
                                    <th>11h</th> <th></th> <th>12h</th> <th></th> <th>13h</th>
                                    <th></th> <th>14h</th> <th></th> <th>15h</th> <th></th>
                                    <th>16h</th> <th></th> <th>17h</th> <th></th> <th>18h</th> <th></th>
                                </tr>
                            </table>
                            {% for i in range(0,6) %}
                                <table>
                                    <tr>
                                        {% for H in (offre[8]|list)[i*22:(i + 1)*22] %}
                                            {% if (H|int) == 0 %}
                                                <td class="white"></td>
                                            {% elif (H|int) == 1 %}
                                                <td class="red"></td>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                </table>
                            {% endfor %}
                        </div>
                    </div>
                    <form class="bouton" method="post" action="/apply">
                        <input type="hidden" name="categorie" value="offre"/>
                        <input type="hidden" name="id" value="{{ offre[0] }}"/>
                        <input type="submit" value="Accepter l'offre"/>
                    </form>
                </div>
            </div>
            <br/>
        {% endfor %}
    {% else %}
        <div class="search_none">
            <div class="bloc" id="none_offre">
                <p class="none_offre">Aucune offre n'a été trouvée</p>
            </div>
        </div>
    {% endif %}
</div>

{% include 'mise_en_page/FOOTER.html' %}

</body>
</html>
